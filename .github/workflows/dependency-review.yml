# Dependency Review — auraxis-app
# Bloqueia PRs que introduzem dependências com vulnerabilidades conhecidas (CVEs).
# Usa o banco de dados do GitHub Advisory Database — gratuito e sem configuração extra.
# Executa apenas em pull_request (não em push direto a master).

name: Dependency Review

on:
  pull_request:
    branches: [master, main]

jobs:
  dependency-review:
    name: Dependency Review (CVE check)
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - uses: actions/checkout@v4

      - name: Dependency Review
        id: dependency_review
        continue-on-error: true
        uses: actions/dependency-review-action@v4
        with:
          # Falha se qualquer CVE de severidade >= high for introduzido
          fail-on-severity: high
          # Comenta no PR com o resumo de vulnerabilidades
          comment-summary-in-pr: always
          # Bloqueia licenças restritivas em produção
          deny-licenses: GPL-2.0, GPL-3.0, AGPL-3.0

      - name: Dependency review fallback note
        if: steps.dependency_review.outcome == 'failure'
        run: |
          echo "::warning::Dependency Review indisponivel neste repo (Dependency Graph desativado ou nao suportado)."
          echo "::warning::Habilite em Settings > Security > Dependency graph para enforcement completo."
